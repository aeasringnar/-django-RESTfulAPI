from redis import StrictRedis
from datetime import datetime
'''
新版的分布式可充入读写锁
实现原理：
1、基本的分布式锁原理，通过设置redis的key nx 即如果key存在则创建，否则返回none，创建锁时增加过期时间参数，默认30秒
2、可以同个key的值加上锁类型，读锁或写锁 以及锁id(防止锁被别人释放) 加上加锁次数 目的是支持可重入的锁，当加锁次数为0时，释放锁
3、在加锁时增加timeout参数，毫秒值，如果有值那么表示加锁时，如果锁被人锁着，那么就进行重试等待 值表示等待的时间，为None时表示不阻塞，有锁时直接返回加锁失败。
4、使用上下文管理器，进入时加锁，离开时释放锁，
'''